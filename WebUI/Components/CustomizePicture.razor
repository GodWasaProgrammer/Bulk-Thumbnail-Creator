@using Bulk_Thumbnail_Creator;
@using Bulk_Thumbnail_Creator.Interfaces;
@using Bulk_Thumbnail_Creator.PictureObjects;
@using MudBlazor.Utilities;
@using UMapx;
@using Bulk_Thumbnail_Creator.Services;
@using WebUI.Components;
@using Bulk_Thumbnail_Creator.Enums;

@inject PicDataService PicDataService
@inject NavigationManager navmanager;
@inject ILogService Logger;
<MudPaper>
    <MudGrid>
        <MudItem xs="12" sm="6">
            <PictureDataBox @ref="@PictureDataBoxRef" ImageURL="@ImageURL" PicData="@CurrentPagePictureData"></PictureDataBox>
        </MudItem>
        <MudItem xs="12" sm="6">
            <CustomizeBox @ref="@CustomizeBoxRef" ImageURL="@ImageURL" CurrentPagePictureData="CurrentPagePictureData" OnCustomBoxHasProducedPicture="SetCustomPicture"></CustomizeBox>
        </MudItem>
    </MudGrid>
</MudPaper>

@code
{
    [Parameter]
    public Job CurrentJob { get; set; }

    [Parameter]
    public PictureData CurrentPagePictureData { get; set; }

    CustomizeBox CustomizeBoxRef;

    PictureDataBox PictureDataBoxRef;

    [Parameter]
    public string ImageURL { get; set; }

    public void SetCustomPicture(PictureData pictureData, string ImageURLInput)
    {
        CurrentPagePictureData = pictureData;

        ImageURL = ImageURLInput;

        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {
        if (CurrentJob == null)
        {
            CurrentJob = await PicDataService.RequestCurrentJob();

            // if we fetched a job lets set the values

            if (CurrentJob != null)
            {
                if (CurrentJob.State == States.CustomPicture)
                {

                }

            }

        }
        else
        {
            if (CurrentJob.State == States.CustomPicture)
            {
                CurrentPagePictureData = PicDataService.SetPictureDataImageDisplayCorrelationForVarietyList(CurrentJob.ClickedImage);
                ImageURL = CurrentJob.ClickedImage;
            }

        }

    }

}